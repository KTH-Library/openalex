test_that("a couple of specific orcids can be rectangularized", {

  my_orcid <- c(
    "0000-0002-6671-8096",
    "0000-0002-0554-0503"
  )

  works <- my_orcid |> openalex_orcid_lookup()
 
  is_valid <- 
    works$work |> nrow() >= 60

  expect_true(is_valid)
})

test_that("works related to twenty orcids can be rectangularized", {

  skip_on_ci()

  my_orcids <- readr::read_lines(
    "0000-0001-7056-4379
0000-0002-3627-8085
0000-0002-4606-4865
0000-0002-0977-2598
0000-0002-5845-3032
0000-0002-4266-6746
0000-0001-7309-8086
0000-0002-9663-7705
0000-0002-6785-8293
0000-0002-2508-391X
0000-0001-7688-1367
0000-0001-7185-0457
0000-0003-0565-9907
0000-0003-3802-7834
0000-0001-7481-2245
0000-0001-9588-0239
0000-0002-2792-1622
0000-0002-8546-1329
0000-0003-1959-6513
0000-0002-1973-3920
0000-0001-8119-5775
")
  
  res <- openalex_orcid_lookup(my_orcids)

  is_valid <- 
    nrow(res$biblio == 100) &
    nrow(res$grants) >= 27 &
    class(res$biblio$biblio_volume) == "character" &
    class(res$grants$award_id) == "character"
    
  expect_true(is_valid)

})


test_that("works for fifty orcids can be harvested to a database", {

  skip_on_ci()

my_orcids <- readr::read_lines(
  "0000-0001-7056-4379
0000-0002-3627-8085
0000-0002-4606-4865
0000-0002-0977-2598
0000-0002-5845-3032
0000-0002-4266-6746
0000-0001-7309-8086
0000-0002-9663-7705
0000-0002-6785-8293
0000-0002-2508-391X
0000-0001-7688-1367
0000-0001-7185-0457
0000-0003-0565-9907
0000-0003-3802-7834
0000-0001-7481-2245
0000-0001-9588-0239
0000-0002-2792-1622
0000-0002-8546-1329
0000-0003-1959-6513
0000-0002-1973-3920
0000-0001-8119-5775
0000-0003-3922-9606
0000-0003-3014-5609
0000-0002-6590-6634
0000-0003-0696-7506
0000-0003-4461-0209
0000-0003-2489-0688
0000-0003-4378-8785
0000-0002-9769-8016
0000-0003-0565-9376
0000-0002-7497-2764
0000-0002-4858-8056
0000-0003-4128-1112
0000-0001-9525-0712
0000-0003-0916-0644
0000-0002-0101-862X
0000-0003-1779-8728
0000-0002-9801-0842
0000-0001-9775-0382
0000-0002-9609-4122
0000-0001-8336-1247
0000-0001-5452-6794
0000-0002-9637-2065
0000-0001-7949-1815
0000-0002-5896-473X
0000-0002-4552-0240
0000-0002-5805-2693
0000-0001-8771-7941
0000-0001-7788-6127
0000-0003-2726-6821
0000-0002-3586-2415
")
  
  res <- orcid_lookup_to_duckdb(my_orcids)

  is_valid <- file.exists(res)
  
  message("Please find the harvested works in duckdb here: ", res)

  expect_true(is_valid)

})
